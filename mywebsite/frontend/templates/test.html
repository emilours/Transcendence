{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="{% static 'css/style.css' %}">
	<link rel="stylesheet" href="{% static 'css/frontend.css' %}">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Potta+One&display=swap">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
	<!-- Font Awesome -->
	<!-- <script src="https://kit.fontawesome.com/14273d579a.js" crossorigin="anonymous"></script> -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap">
	<script type="importmap">
		{
			"imports": {
				"three": "https://cdn.jsdelivr.net/npm/three@0.139.2/build/three.module.js",
				"three/examples/jsm/controls/OrbitControls.js": "https://cdn.jsdelivr.net/npm/three@0.139.2/examples/jsm/controls/OrbitControls.js",
				"three/examples/jsm/geometries/TextGeometry.js": "https://cdn.jsdelivr.net/npm/three@0.139.2/examples/jsm/geometries/TextGeometry.js",
				"three/examples/jsm/loaders/FontLoader.js": "https://cdn.jsdelivr.net/npm/three@0.139.2/examples/jsm/loaders/FontLoader.js"
			}
		}
	</script>
</head>
<body class="d-flex flex-fill flex-column vh-100">
	<header class="font-potta">
		<nav class="navbar navbar-expand-md navbar-light bg-light fixed-top p-0">
			<div class="container-fluid bg-secondary">
				<a class="navbar-brand">
					<img src="{% static 'img/pusheen_nav.png' %}" alt="pusheen face icon" width="60" height="60">
				</a>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
				aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse align justify-content-between my-2" id="navbarContent">
					<ul class="navbar-nav mx-auto align-items-center">
						<li class="nav-item">
							<a class="nav-link active" aria-current="page" href="#" id="home">Home</a>
						</li>
						{% if user.is_authenticated %}
						<li class="nav-item">
							<a class="nav-link" href="#" id="navbar-games">Games</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#" id="navbar-leaderboard">Leaderboard</a>
						</li>
						{% endif %}
						<li class="nav-item">
							<button id="decrease-font" class="btn btn-secondary shadow-none btn-lg" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Decrease font size">
								<i class="bi bi-dash-circle"></i>
								<span class="d-md-none ms-1 fs-6">Decrease font size</span>
							</button>
						</li>
						<li class="nav-item">
							<button id="increase-font" class="btn btn-secondary shadow-none btn-lg" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Increase font size">
								<i class="bi bi-plus-circle"></i>
								<span class="d-md-none ms-1 fs-6">Increase font size</span>
							</button>
						</li>
						<li class="nav-item">
							<button id="toggle-contrast" class="btn btn-secondary shadow-none btn-lg" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Toggle high contrast">
								<i class="bi bi-eye"></i>
								<span class="d-md-none ms-1 fs-6">High Contrast</span>
							</button>
						</li>
						<li class="nav-item dropdown ms-3 mb-4 mb-md-0">
							<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
								<img src="{% static 'img/global.png' %}" alt="Choose your language icon" width="24" height="24">
								<span class="d-md-none ms-1 fs-6">Languages</span>
							</a>
							<ul class="dropdown-menu rounded-3 bg-secondary dropdown-menu-primary" aria-labelledby="navbarDropdown">
								<li><a class="dropdown-item" href="#">English</a></li>
								<li><a class="dropdown-item" href="#">French</a></li>
								<li><a class="dropdown-item" href="#">Spanish</a></li>
							</ul>
						</li>
					</ul>
					{% if user.is_authenticated %}
					<div class="d-flex justify-content-center align-items-center">
						<img src="{{ user.avatar.url }}" alt="Profile Image/Avatar icon" class="rounded-circle" width="60" height="60">
						<button type="button" class="btn btn-outline-primary rounded-pill border-dark text-dark ms-2" id="navbar-profile">Profile</button>
						<form id="logout-form" method="POST" action="{% url 'home' %}" data-csrf-token="{{ csrf_token }}">
							{% csrf_token %}
							<button type="submit" class="btn btn-primary rounded-pill ms-2">Sign out</button>
						</form>
					</div>
					{% else %}
					<div class="d-flex justify-content-center">

						<button type="button" class="btn btn-outline-primary rounded-pill border-dark text-dark" id="navbar-login">Login</button>
						<button type="button" class="btn btn-primary rounded-pill ms-2" id="navbar-signup">Sign up</button>
					</div>
					{% endif %}
				</div>
			</div>
		</nav>
	</header>

	<section class="d-flex align-items-center justify-content-center mt-5">
		<div class="container mb-5">
			<div class="row justify-content-center mt-2 g-3">
				<div class="col-12 col-lg-6 col-xxl-4">
					<div class="card shadow rounded-4">
						<div class="card-header text-center bg-primary font-potta rounded-top-4">
							<h2>Profile</h2>
						</div>
						<div class="card-body p-5">
							<div class="text-center mb-4">
								<img src="{{ user.avatar.url }}" alt="{{ user.display_name }}'s Avatar" class="rounded-circle" width="120" height="120">
							</div>
							<h3 class="card-title text-center mb-4 font-potta">{{ user.display_name }}</h3>
							<p class="text-center mb-4 inversed-color"><strong>{{ user.first_name }} {{ user.last_name }}</strong></p>
							<p class="text-center mb-4 inversed-color"><strong>Email:</strong> {{ user.email }}</p>
							<div class="text-center">
								<a href="" class="btn btn-secondary mb-2 rounded-3" id="edit-profile">Edit Profile</a>
								<a href="" class="btn btn-secondary ms-2 mb-2 rounded-3" id="edit-password">Edit Password</a>
								<a href="" class="btn btn-danger ms-2 mb-2 rounded-3" id="delete-account" onclick="return confirm('Are you sure you want to delete your account?');">Delete Account</a>
							</div>
							<hr>
							<h4 class="text-center font-roboto mb-4">Pong Stats</h4>
							<div class="d-flex justify-content-around mb-4">
								<div>
									<h5 class="text-center">Victories</h5>
									<p class="text-center inversed-color">Not defined in model</p>
								</div>
								<div>
									<h5 class="text-center">Defeats</h5>
									<p class="text-center inversed-color">Not defined in model</p>
								</div>
								<div>
									<h5 class="text-center">Score</h5>
									<p class="text-center inversed-color">Not defined in model</p>
								</div>
							</div>
							<hr>
							<h4 class="text-center font-roboto mb-4">Invaders Stats</h4>
							<div class="d-flex justify-content-around mb-4">
								<div>
									<h5 class="text-center">Victories</h5>
									<p class="text-center inversed-color">{{ user.victories }}</p>
								</div>
								<div>
									<h5 class="text-center">Defeats</h5>
									<p class="text-center inversed-color">{{ user.defeats }}</p>
								</div>
								<div>
									<h5 class="text-center">Score</h5>
									<p class="text-center inversed-color">Not defined in model</p>
								</div>
							</div>

						</div>
					</div>
				</div>

				<div class="col-12 col-lg-6 col-xxl-4">
					<div class="card shadow rounded-4">
						<div class="card-header text-center bg-primary font-potta rounded-top-4">
							<h2>Friends</h2>
						</div>
						<div class="card-body p-4">
							<form id="add-friend-form" method="POST" action="{% url 'profile' %}">
								{% csrf_token %}
								<div class="input-group mb-3">
									<input id="receiver_email" type="email" name="receiver_email" class="form-control rounded-start-3" placeholder="Enter friend's email" required>
									<button type="submit" class="btn btn-secondary rounded-end-3">Add Friend</button>
								</div>
							</form>
							{% if user.friend_list.friends.all %}
							<ul class="list-group">
								{% for friend in user.friend_list.friends.all %}
									<li class="list-group-item d-flex justify-content-between align-items-center rounded-3">
										<div>
											<img src="{{ friend.avatar.url }}" alt="{{ friend.display_name }}'s Avatar" class="rounded-circle me-2" width="40" height="40">
											<strong>{{ friend.display_name }}</strong>
										</div>
										<div>
											<span class="badge rounded-3 {% if friend.is_online %}bg-secondary text-black{% else %}bg-light{% endif %} p-2">{{ friend.is_online|yesno:"Online,Offline" }}</span>
											<form method="POST" action="/auth/remove_friend/{{ friend.id }}/" class="d-inline remove-friend-form">
												{% csrf_token %}
												<button type="submit" class="btn btn-light btn-sm rounded-3">Remove</button>
											</form>
										</div>
									</li>
								{% endfor %}
							</ul>
						{% else %}
							<p class="text-center inversed-color">You have no friends added yet.</p>
						{% endif %}
						</div>
					</div>
				</div>

				<div class="col-12 col-lg-6 col-xxl-4">
					<div class="card shadow rounded-4">
						<div class="card-header text-center bg-primary font-potta rounded-top-4">
							<h2>Friend's Invitations</h2>
						</div>
						<div class="card-body p-4">

							<h4 class="text-center mb-3">Received</h4>
							{% if pending_requests %}
								<ul class="list-group mb-4">
									{% for request in pending_requests %}
										<li class="list-group-item d-flex justify-content-between align-items-center rounded-3">
											<div>
												<img src="{{ request.sender.avatar.url }}" alt="{{ request.sender.display_name }}'s Avatar" class="rounded-circle me-2" width="40" height="40">
												<strong>{{ request.sender.display_name }}</strong>
											</div>
											<div>
												<form method="POST" action="/auth/accept_friend_request/{{ request.id }}/" class="d-inline accept-friend-request">
													{% csrf_token %}
													<button type="submit" class="btn btn-secondary btn-sm rounded-3">Accept</button>
												</form>
												<form method="POST" action="/auth/refuse_friend_request/{{ request.id }}/" class="d-inline refuse-friend-request">
													{% csrf_token %}
													<button type="submit" class="btn btn-light btn-sm rounded-3">Decline</button>
												</form>
											</div>
										</li>
									{% endfor %}
								</ul>
							{% else %}
								<p class="text-center inversed-color">No pending friend requests.</p>
							{% endif %}

							<h4 class="text-center mb-3">Sent</h4>
							{% if sent_requests %}
								<ul class="list-group">
									{% for request in sent_requests %}
										<li class="list-group-item d-flex justify-content-between align-items-center rounded-3">
											<div>
												<img src="{{ request.receiver.avatar.url }}" alt="{{ request.receiver.display_name }}'s Avatar" class="rounded-circle me-2" width="40" height="40">
												<strong>{{ request.receiver.display_name }}</strong>
											</div>
											<div>
												<span class="badge bg-secondary text-black p-2 rounded-3">Pending...</span>
												<form method="POST" action="/auth/cancel_friend_request/{{ request.id }}/" class="d-inline cancel-friend-request">
													{% csrf_token %}
													<button type="submit" class="btn btn-light btn-sm rounded-3">Cancel</button>
												</form>
											</div>
										</li>
									{% endfor %}
								</ul>
							{% else %}
								<p class="text-center inversed-color">No sent friend requests.</p>
							{% endif %}

						</div>
					</div>
				</div>
			</div>
		</div>
	</section>


	<footer class="border-top border-info mt-2 font-potta" id="footer">
		<div class="container-fluid py-4 bg-secondary">
			<div class="row gy-2 align-items-center">
				<div class="col-12 col-md-4 d-flex justify-content-center justify-content-md-start">
					<a class="navbar-brand text-dark text-uppercase fw-bold" href="#">
						<span class="bg-primary bg-gradient p-1 rounded-3 text-info">Push</span>een
					</a>
				</div>
				<div class="col-12 col-md-4 d-flex justify-content-center text-md-center">
					<ul class="list-unstyled mb-0">
						<li>
							<a href="" class="text-decoration-none text-dark" data-bs-toggle="modal" data-bs-target="#aboutUs">About Us</a>
						</li>
					</ul>
				</div>
				<div class="col-12 col-md-4 d-flex justify-content-center justify-content-md-end">
					<ul class="list-inline mb-0">
						<li class="list-inline-item">
							<a href="https://42.fr/en/homepage/" target="_blank" class="text-decoration-none text-dark" data-bs-toggle="tooltip" title="school 42">
								<img src="{% static 'img/42_Logo.png' %}" alt="school 42 icon" width="24" height="24">
							</a>
						</li>
						<li class="list-inline-item" >
							<a href="https://github.com/Ariti-87/ft_transcendence" target="_blank" class="text-decoration-none text-dark" data-bs-toggle="tooltip" title="github">
								<i class="bi bi-github fs-5"></i>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div>

		<!-- Modal -->
		<div class="modal fade" id="aboutUs" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">About Us</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<p>We are students from 42, a revolutionary coding school known for its peer-to-peer learning model and innovative curriculum. As part of our journey in becoming proficient developers,
						we are undertaking the Transcendence Project, a unique and challenging task designed to push our limits and expand our skills.</p>
						<p>The Transcendence Project is an ambitious endeavor where we create a fully functional and secure website that facilitates real-time multiplayer games,
						specifically focusing on the classic game of Pong. This project encompasses a wide range of technical requirements, including frontend and backend development, user authentication, security measures, and seamless user experience.</p>
					</div>
				</div>
			</div>
		</div>

	</footer>
	<script> const userDisplayName = "{{ user.display_name }}"; </script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
	crossorigin="anonymous"></script>
	<script src="{% static 'js/bootstrap.js' %}"></script>
	<script type="module" src="{% static 'js/frontend.js' %}"></script>
	<script src="https://cdn.jsdelivr.net/npm/gifler@0.1.0/gifler.min.js"></script>
</body>
</html>
